---
permalink: protect-sco/task_restore_an_oracle_database.html 
sidebar: sidebar 
keywords: restore, recover, Oracle 
summary: データ損失が発生した場合は、 SnapCenter を使用して 1 つ以上のバックアップからアクティブファイルシステムにデータをリストアし、そのあとにデータベースをリカバリできます。 
---
= Oracleデータベースのリストアとリカバリ
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
データ損失が発生した場合は、 SnapCenter を使用して 1 つ以上のバックアップからアクティブファイルシステムにデータをリストアし、そのあとにデータベースをリカバリできます。

* 始める前に *

root以外のユーザとしてプラグインをインストールした場合は、実行権限をプリスクリプトディレクトリとポストスクリプトディレクトリに手動で割り当てる必要があります。

* このタスクについて *

* リカバリは、設定したアーカイブログの場所にあるアーカイブログを使用して実行されます。データベースがARCHIVELOGモードで実行されている場合は、REDOログファイルのいっぱいになったグループが1つ以上のオフラインデスティネーション（まとめてアーカイブREDOログ）に保存されます。SnapCenterは、指定したSCN、選択した日時、または[すべてのログ]オプションに基づいて、最適な数のログバックアップを特定してマウントします。リカバリに必要なアーカイブログが設定された場所にない場合は、ログを含むSnapshotをマウントし、パスを外部アーカイブログとして指定する必要があります。
+
ASMデータベースをASMlibからASMFDに移行する場合、ASMlibで作成されたバックアップを使用してデータベースをリストアすることはできません。ASMFD設定でバックアップを作成し、リストアに使用する必要があります。同様に、ASMデータベースをASMFDからASMlibに移行する場合は、リストアするバックアップをASMlib構成で作成する必要があります。

+
データベースをリストアすると、データベースで複数の処理が実行されないように、Oracleデータベースホスト上の_/var/opt/snapcenter/sco/lockディレクトリに運用ロックファイル（.SM_lock_dbsid）が作成されます。処理ロックファイルは、データベースのリストアが完了すると自動的に削除されます。

+

NOTE: SPFILEおよびパスワードファイルのリストアはサポートされていません。

* SnapLockが有効なポリシーの場合、ONTAP 9.12.1以前のバージョンでは、Snapshotロック期間を指定すると、リストアの一環として改ざん防止Snapshotから作成されたクローンにSnapLockの有効期限が継承されます。SnapLockの有効期限が過ぎた時点で、ストレージ管理者がクローンを手動でクリーンアップする必要があります。


* 手順 *

. 左側のナビゲーションペインで、 * リソース * をクリックし、リストから適切なプラグインを選択します。
. [ リソース ] ページで、 [ * 表示 ] リストから [ * データベース * ] または [ * リソースグループ * ] を選択します。
. データベースの詳細ビューまたはリソースグループの詳細ビューでデータベースを選択します。
+
データベーストポロジページが表示されます。

. Manage Copies （コピーの管理）ビューから、プライマリまたはセカンダリ（ミラーまたはレプリケートされた）ストレージシステムから * Backups （バックアップ） * を選択します。
. 表からバックアップを選択し、**をクリックしますimage:../media/restore_icon.gif["リストアアイコン"]。
. Restore Scope ページで、次のタスクを実行します。
+
.. Real Application Clusters（RAC）環境でデータベースのバックアップを選択した場合は、RACノードを選択します。
.. ミラーデータまたはバックアップデータを選択する場合：
+
*** ミラーまたはバックアップにログバックアップがない場合は、何も選択されず、ロケータは空になります。
*** ログバックアップがミラーまたはバックアップに存在する場合は、最新のログバックアップが選択され、対応するロケータが表示されます。
+

NOTE: 選択したログバックアップがミラーとバックアップの両方の場所に存在する場合は、両方のロケータが表示されます。



.. 次の操作を実行します。
+
|===
| リストアの対象 | 操作 


 a| 
データベースのすべてのデータファイル
 a| 
「 * すべてのデータファイル * 」を選択します。

データベースのデータファイルのみがリストアされます。制御ファイル、アーカイブログ、またはREDOログファイルはリストアされません。



 a| 
表領域
 a| 
[ * 表領域 * ] を選択します。

リストアする表領域を指定できます。



 a| 
制御ファイル
 a| 
「 * 制御ファイル * 」を選択します。


NOTE: 制御ファイルをリストアするときは、ディレクトリ構造が存在するか、または正しいユーザおよびグループの所有権を持つディレクトリ構造が作成されていることを確認してください（存在する場合）。これにより、リストアプロセスによってファイルがターゲットの場所にコピーされるようになります。ディレクトリが存在しない場合、リストアジョブは失敗します。



 a| 
Redoログファイル
 a| 
[ 再実行ログファイル ] を選択します。

このオプションは、Data GuardスタンバイデータベースまたはActive Data Guardスタンバイデータベースでのみ使用できます。


NOTE: Data Guard以外のデータベースのREDOログファイルはバックアップされません。Data Guard以外のデータベースでは、リカバリはアーカイブログを使用して実行されます。



 a| 
プラガブルデータベース（PDB）
 a| 
Pluggable Database * を選択し、リストアする PDB を指定します。



 a| 
プラガブルデータベース（PDB）の表領域
 a| 
Pluggable Database （ PDB ） tablespaces * を選択し、リストアする PDB とその PDB の表領域を指定します。

このオプションは、リストア対象としてPDBを選択した場合にのみ使用できます。

|===
.. リストアとリカバリに必要な場合は、「 * データベースの状態を変更」を選択して、データベースの状態をリストアとリカバリ処理の実行に必要な状態に変更します。
+
データベースの状態には、open、mounted、started、およびshutdownがあります。データベースの状態が上位で、リストア処理を実行するために下位の状態に変更する必要がある場合は、このチェックボックスをオンにする必要があります。データベースの状態が低いものの、リストア処理を実行するために高い状態に変更する必要がある場合は、このチェックボックスをオンにしていなくても、データベースの状態が自動的に変更されます。

+
データベースがOPEN状態であり、リストアのためにデータベースをMOUNTED状態にする必要がある場合は、このチェック・ボックスを選択した場合にのみ、データベースの状態が変更されます。

.. バックアップ後に新しいデータファイルが追加された場合や、 LUN が LVM ディスクグループに追加、削除、再作成された場合にインプレースリストアを実行するには、 * Force in place restore * を選択します。


. Recovery Scope ページで、次のアクションを実行します。
+
|===
| 状況 | 操作 


 a| 
最後のトランザクションまでリカバリする場合
 a| 
[ * すべてのログ * ] を選択します。



 a| 
特定のSystem Change Number（SCN；システム変更番号）にリカバリする場合
 a| 
[* Until SCN （ System Change Number ） ] を選択します。



 a| 
特定のデータと時間にリカバリする必要がある
 a| 
[ * 日付と時刻 * ] を選択します。

データベースホストのタイムゾーンの日時を指定する必要があります。



 a| 
リカバリが不要である場合
 a| 
「 * リカバリなし * 」を選択します。



 a| 
外部アーカイブログの場所を指定
 a| 
データベースがARCHIVELOGモードで実行されている場合、SnapCenterは、指定したSCN、選択した日時、または[すべてのログ]オプションに基づいて、最適な数のログバックアップを特定してマウントします。

外部アーカイブログファイルの場所を指定する場合は、 * 外部アーカイブログの場所を指定 * を選択します。

バックアップの一環としてアーカイブログが削除された場合に、必要なアーカイブログのバックアップを手動でマウントした場合は、リカバリ用の外部アーカイブログの場所として、マウントしたバックアップのパスを指定する必要があります。


NOTE: 外部ログの場所としてリストする前に、マウントパスのパスと内容を確認する必要があります。

** https://docs.netapp.com/us-en/ontap-apps-dbs/oracle/oracle-dp-overview.html["ONTAPによるOracleデータ保護"^]
** https://kb.netapp.com/Advice_and_Troubleshooting/Data_Protection_and_Security/SnapCenter/ORA-00308%3A_cannot_open_archived_log_ORA_LOG_arch1_123_456789012.arc["ORA-00308 エラーで処理が失敗します"^]


|===
+
アーカイブログボリュームが保護されておらず、データボリュームが保護されている場合は、セカンダリバックアップからリカバリを伴うリストアを実行できません。リストアするには、「 * リカバリなし * 」を選択する必要があります。

+
OPEN DATABASEオプションを選択してRACデータベースをリカバリする場合、リカバリ処理が開始されたRACインスタンスだけがOPEN状態に戻ります。

+

NOTE: Data GuardスタンバイデータベースおよびActive Data Guardスタンバイデータベースでは、リカバリがサポートされません。

. PreOps ページで、リストア処理の前に実行するプリスクリプトのパスと引数を入力します。
+
プリスクリプトは、 _ /var/opt/snapcenter /spl/scripts_path またはこのパス内の任意のフォルダに保存する必要があります。デフォルトでは、 /var/opt/snapcenter /spl/scripts_path が読み込まれます。スクリプトを保存するフォルダをこのパス内に作成してある場合は、パス内のそれらのフォルダを指定する必要があります。

+
スクリプトのタイムアウト値を指定することもできます。デフォルト値は60秒です。

+
SnapCenterでは、プリスクリプトとポストスクリプトの実行時に、事前定義された環境変数を使用できます。 link:../protect-sco/predefined-environment-variables-prescript-postscript-restore.html["詳細"^]

. PostOps ページで、次の手順を実行します。
+
.. リストア処理のあとに実行するポストスクリプトのパスと引数を入力します。
+
ポストスクリプトは、 _ /var/opt/snapcenter /spl/scripts_or のいずれか、このパス内の任意のフォルダに保存する必要があります。デフォルトでは、 /var/opt/snapcenter /spl/scripts_path が読み込まれます。スクリプトを保存するフォルダをこのパス内に作成してある場合は、パス内のそれらのフォルダを指定する必要があります。

+

NOTE: リストア処理が失敗した場合、ポストスクリプトは実行されず、クリーンアップアクティビティが直接トリガーされます。

.. リカバリ後にデータベースを開く場合は、このチェックボックスを選択します。
+
リカバリ後にデータベースを開くように指定した場合は、制御ファイルがあるかどうかに関係なくコンテナデータベース（CDB）をリストアしたあと、またはCDB制御ファイルのみをリストアしたあとにCDBのみが開き、CDB内のPluggable Database（PDB）は開きません。

+
RACセットアップでは、リカバリに使用されるRACインスタンスのみがリカバリ後に開かれます。

+

NOTE: 制御ファイルを含むユーザ表領域、制御ファイルを含む/含まないシステム表領域、制御ファイルを含む/含まないPDBをリストアすると、リストア処理に関連するPDBの状態だけが元の状態に変更されます。リストアに使用されなかった他のPDBの状態は保存されていないため、元の状態に変更されません。リストアに使用されなかったPDBの状態を手動で変更する必要があります。



. [ 通知 ] ページの [ 電子メールの設定 *] ドロップダウンリストから、電子メール通知を送信するシナリオを選択します。
+
また、送信者と受信者のEメールアドレス、およびEメールの件名を指定する必要があります。実行したリストア処理のレポートを添付する場合は、 [ ジョブレポートの添付 ] を選択する必要があります。

+

NOTE: Eメール通知を使用する場合は、GUIまたはPowerShellコマンドSet-SmSmSmtpServerを使用して、SMTPサーバの詳細を指定しておく必要があります。

. 概要を確認し、 [ 完了 ] をクリックします。
. 操作の進行状況を監視するには、 * Monitor * > * Jobs * をクリックします。


* 詳細はこちら *

* https://kb.netapp.com/Advice_and_Troubleshooting/Data_Protection_and_Security/SnapCenter/Oracle_RAC_One_Node_database_is_skipped_for_performing_SnapCenter_operations["SnapCenter 処理では、 Oracle RAC One Node データベースがスキップされます"^]
* https://kb.netapp.com/Advice_and_Troubleshooting/Data_Protection_and_Security/SnapCenter/Failed_to_restore_from_a_secondary_SnapMirror_or_SnapVault_location["セカンダリの SnapMirror または SnapVault の場所からリストアできませんでした"^]
* https://kb.netapp.com/Advice_and_Troubleshooting/Data_Protection_and_Security/SnapCenter/Failed_to_restore_when_a_backup_of_an_orphan_incarnation_is_selected["孤立したインカネーションのバックアップからのリストアに失敗しました"^]
* https://kb.netapp.com/Advice_and_Troubleshooting/Data_Protection_and_Security/SnapCenter/What_are_the_customizable_parameters_for_backup_restore_and_clone_operations_on_AIX_systems["AIX システムでのバックアップ、リストア、クローニングの各処理のパラメータをカスタマイズできます"^]

