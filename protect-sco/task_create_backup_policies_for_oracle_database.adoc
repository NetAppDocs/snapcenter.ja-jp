---
permalink: protect-sco/task_create_backup_policies_for_oracle_database.html 
sidebar: sidebar 
keywords: backup policies, policies 
summary: SnapCenter を使用して Oracle データベースリソースをバックアップする前に、バックアップ対象のリソースまたはリソースグループのバックアップポリシーを作成する必要があります。バックアップポリシーとは、バックアップを管理、スケジューリング、および保持する方法を定めた一連のルールです。レプリケーション、スクリプト、バックアップタイプの設定を指定することもできます。ポリシーを作成することで、別のリソースやリソースグループでポリシーを再利用して時間を節約することができます。 
---
= Oracle データベースのバックアップポリシーの作成
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
SnapCenter を使用して Oracle データベースリソースをバックアップする前に、バックアップ対象のリソースまたはリソースグループのバックアップポリシーを作成する必要があります。バックアップポリシーとは、バックアップを管理、スケジューリング、および保持する方法を定めた一連のルールです。レプリケーション、スクリプト、バックアップタイプの設定を指定することもできます。ポリシーを作成することで、別のリソースやリソースグループでポリシーを再利用して時間を節約することができます。

* 必要なもの *

* バックアップ戦略を定義しておく必要があります。
* SnapCenter のインストール、ホストの追加、データベースの検出、ストレージシステム接続の作成などのタスクを実行して、データ保護の準備をしておく必要があります。
* Snapshot コピーをミラーセカンダリストレージまたはバックアップセカンダリストレージにレプリケートするユーザには、 SnapCenter 管理者がユーザに対してソースとデスティネーションの両方のボリューム用に SVM を割り当てる必要があります。


* 手順 *

. 左側のナビゲーションペインで、 * 設定 * をクリックします。
. [ 設定 ] ページで、 [ * ポリシー * ] をクリックします。
. ドロップダウン・リストから「 * Oracle Database * 」を選択します。
. [ 新規作成（ New ） ] をクリックする。
. [ 名前 ] ページで、ポリシー名と概要を入力します。
. [Backup Type] ページで、次の手順を実行します。
+
** オンライン・バックアップ * を作成する場合は、 * オンライン・バックアップ * を選択します。
+
バックアップの対象として、すべてのデータファイル、制御ファイル、アーカイブログファイル、データファイルと制御ファイル、またはアーカイブログファイルのみを指定する必要があります。

** オフライン・バックアップ * を作成する場合は、 * オフライン・バックアップ * を選択し、次のいずれかのオプションを選択します。
+
*** データベースがマウント状態のときにオフラインバックアップを作成する場合は、 * Mount * を選択します。
*** データベースをシャットダウン状態に変更してオフラインシャットダウンバックアップを作成する場合は、 * Shutdown * を選択します。
+
Pluggable Database （ PDB ）がある場合、バックアップ作成前に PDB の状態を保存するには、「 * PDB の状態を保存」を選択する必要があります。これにより、バックアップ作成後に PDB を元の状態に戻すことができます。



** オンデマンド * 、 * 毎時 * 、 * 毎日 * 、 * 毎週 * 、または * 毎月 * を選択して、スケジュールの頻度を指定します。
+

NOTE: リソースグループを作成する際に、バックアップ処理のスケジュール（開始日と終了日）を指定することができます。これにより、ポリシーとバックアップ間隔が同じである複数のリソースグループを作成できますが、各ポリシーに異なるバックアップスケジュールを割り当てることもできます。

+

NOTE: 午前 2 時にスケジュールを設定した場合、夏時間（ DST ）中はスケジュールはトリガーされません。

** Oracle Recovery Manager （ RMAN ）を使用してバックアップをカタログ化する場合は、 [* Catalog backup with Oracle Recovery Manager （ RMAN ） * ] を選択します。
+
一度に 1 つのバックアップのカタログ化を実行するには、 GUI を使用するか、 SnapCenter CLI コマンド Catalog-SmBackupWithOracleRMAN を使用します。

+

NOTE: RAC データベースのバックアップをカタログ化する場合は、そのデータベースに対して他のジョブが実行されていないことを確認します。別のジョブが実行されている場合は、カタログ化処理がキューに登録されずに失敗します。

** バックアップ後にアーカイブ・ログのプルーニングを行う場合は、バックアップ後にアーカイブ・ログをプルーニング * を選択します。
+

NOTE: データベースで設定されていないアーカイブ・ログ・デスティネーションからのアーカイブ・ログの削除は、スキップされます。

+

IMPORTANT: Oracle Standard Edition を使用している場合は、アーカイブログのバックアップ中に log_archive_dest パラメータと log_archive_duplex_dest パラメータを使用できます。

** アーカイブログを削除できるのは、アーカイブログファイルをバックアップの一部として選択した場合だけです。
+

NOTE: 削除処理を正常に行うには、 RAC 環境のすべてのノードがすべてのアーカイブログの場所にアクセスできることを確認する必要があります。

+
|===
| 状況 | 作業 


 a| 
すべてのアーカイブログを削除します
 a| 
[Delete all archive logs*] を選択します。



 a| 
古いアーカイブログを削除します
 a| 
「 * 次より古いアーカイブログを削除」を選択し、削除するアーカイブログの経過時間を日数と時間数で指定します。



 a| 
すべてのデスティネーションからアーカイブログを削除します
 a| 
すべての保存先からアーカイブ・ログを削除する * を選択します。



 a| 
バックアップの一部であるログデスティネーションからアーカイブログを削除します
 a| 
[ * バックアップの一部である保存先からアーカイブ・ログを削除する * ] を選択します。

|===
+
image:../media/sco_backuppolicy_prunning.gif[""]



. [ 保持 ] ページで ' バックアップ・タイプの保持設定と [ バックアップ・タイプ ] ページで選択したスケジュール・タイプを指定します
+
|===


| 状況 | 作業 


 a| 
一定数の Snapshot コピーを保持します
 a| 
保持する Snapshot コピーの総数 * を選択し、保持する Snapshot コピーの数を指定します。

Snapshot コピーの数が指定した数を超えると、古いものから順に Snapshot コピーが削除されます。


NOTE: 最大保持数は、 ONTAP 9.4 以降のリソースでは 1018 、 ONTAP 9.3 以前のリソースでは 254 です。保持期間を基盤となる ONTAP バージョンの値よりも大きい値に設定すると、バックアップが失敗します。


IMPORTANT: SnapVault レプリケーションを有効にする場合は、保持数を 2 以上に設定する必要があります。保持数を 1 に設定すると、新しい Snapshot コピーがターゲットにレプリケートされるまで最初の Snapshot コピーが SnapVault 関係の参照 Snapshot コピーになるため、保持処理が失敗することがあります。



 a| 
Snapshot コピーを特定の日数だけ保持します
 a| 
「 * Snapshot コピーを保持する期間」を選択し、 Snapshot コピーを削除するまで保持する日数を指定します。

|===
+

NOTE: アーカイブログバックアップを保持できるのは、アーカイブログファイルをバックアップの一部として選択した場合だけです。

. Replication （レプリケーション）ページで、レプリケーション設定を指定します。
+
|===
| フィールド | 手順 


 a| 
ローカル Snapshot コピーの作成後に SnapMirror を更新します
 a| 
別のボリュームにバックアップセットのミラーコピーを作成する場合（ SnapMirror レプリケーション）は、このフィールドを選択します。



 a| 
ローカル Snapshot コピーの作成後に SnapVault を更新します
 a| 
ディスクツーディスクのバックアップレプリケーション（ SnapVault バックアップ）を実行する場合は、このオプションを選択します。



 a| 
セカンダリポリシーのラベル
 a| 
Snapshot ラベルを選択します。

選択した Snapshot コピーラベルに応じて、 ONTAP はラベルに一致するセカンダリ Snapshot コピー保持ポリシーを適用します。


NOTE: ローカル Snapshot コピーの作成後に「 * SnapMirror を更新」を選択した場合は、必要に応じてセカンダリポリシーラベルを指定できます。ただし、ローカル Snapshot コピーの作成後に「 * Update SnapVault 」を選択した場合は、セカンダリポリシーラベルを指定する必要があります。



 a| 
エラー再試行回数
 a| 
処理が停止されるまでに試行できるレプリケーションの最大回数を入力します。

|===
+

NOTE: セカンダリストレージでの Snapshot コピーの最大数に達しないように、 ONTAP でセカンダリストレージの SnapMirror 保持ポリシーを設定する必要があります。

. スクリプトページで、バックアップ処理の前後に実行するプリスクリプトまたはポストスクリプトのパスと引数を入力します。
+
プリスクリプトとポストスクリプトは、 /var/opt/snapcenter /spl/scripts_or に保存するか、このパス内の任意のフォルダに保存する必要があります。デフォルトでは、 /var/opt/snapcenter /spl/scripts_path が読み込まれます。スクリプトを保存するフォルダをこのパス内に作成してある場合は、パス内のそれらのフォルダを指定する必要があります。

+
スクリプトのタイムアウト値を指定することもできます。デフォルト値は 60 秒です。

+
SnapCenter では、プリスクリプトとポストスクリプトを実行する際に、事前定義された環境変数を使用できます。 link:../protect-sco/predefined-environment-variables-prescript-postscript-backup.html["詳細はこちら。"^]

. [Verification] ページで、次の手順を実行します。
+
.. 検証処理を実行するバックアップスケジュールを選択します。
.. 検証スクリプトのコマンドセクションで、検証処理の前後に実行するプリスクリプトまたはポストスクリプトのパスと引数を入力します。
+
プリスクリプトとポストスクリプトは、 /var/opt/snapcenter /spl/scripts_or に保存するか、このパス内の任意のフォルダに保存する必要があります。デフォルトでは、 /var/opt/snapcenter /spl/scripts_path が読み込まれます。スクリプトを保存するフォルダをこのパス内に作成してある場合は、パス内のそれらのフォルダを指定する必要があります。

+
スクリプトのタイムアウト値を指定することもできます。デフォルト値は 60 秒です。



. 概要を確認し、 [ 完了 ] をクリックします。

