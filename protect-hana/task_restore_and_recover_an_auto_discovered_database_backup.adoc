---
permalink: protect-hana/task_restore_and_recover_an_auto_discovered_database_backup.html 
sidebar: sidebar 
keywords: SnapCenter Plug-in for SAP HANA Database 
summary: SnapCenterを使用すると、1つ以上のバックアップからデータをリストアおよびリカバリできます。 
---
= 自動検出されたデータベースバックアップのリストアとリカバリ
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
SnapCenterを使用すると、1つ以上のバックアップからデータをリストアおよびリカバリできます。

.開始する前に
* リソースまたはリソースグループをバックアップしておく必要があります。
* リストアするリソースまたはリソースグループに対して実行中のバックアップ処理がある場合は、キャンセルしておく必要があります。
* リストア前、リストア後、マウント、およびアンマウントの各コマンドを実行する場合は、プラグインホストで使用可能なコマンドリストにコマンドが存在するかどうかを次のパスから確認する必要があります。
+
** Windowsホストのデフォルトの場所：_C：\Program NetApp SnapCenter SnapCenter Plug-in Creator\etc\allowed_commands.config_
** Linuxホストのデフォルトの場所：_/opt/linux/scc/etc/allowed_commands.config_ NetApp SnapCenter





NOTE: コマンドがコマンドリストに存在しない場合、処理は失敗します。

.タスクの内容
* ファイルベースのバックアップコピーをSnapCenterからリストアすることはできません。
* SnapCenter 4.3にアップグレードすると、SnapCenter 4.2で作成したバックアップはリストアできますが、リカバリすることはできません。SnapCenter 4.2で作成されたバックアップをリカバリするには、SnapCenter外部のHANA StudioまたはHANAリカバリスクリプトを使用する必要があります。
* ONTAP 9 .12.1以前のバージョンでは、リストアの一環としてSnapLockヴォールトSnapshotから作成されたクローンには、SnapLockヴォールトの有効期限が継承されます。SnapLockの有効期限が過ぎた時点で、ストレージ管理者がクローンを手動でクリーンアップする必要があります。
* SnapMirrorのアクティブな同期のリストア処理では、プライマリの場所からバックアップを選択する必要があります。


.手順
. 左側のナビゲーションペインで、 * リソース * をクリックし、リストから適切なプラグインを選択します。
. [ リソース ] ページで、リソースタイプに基づいて、 *View*] ドロップダウンリストからリソースをフィルタリングします。
+
リソースがタイプ、ホスト、関連するリソースグループとポリシー、およびステータスとともに表示されます。

+

NOTE: バックアップはリソースグループのものである場合もありますが、リストアするリソースを個別に選択する必要があります。

+
リソースが保護されていない場合は ' 保護されていないというメッセージが [ 全体のステータス ] 列に表示されますリソースが保護されていないか、別のユーザによってバックアップされている可能性があります。

. リソースを選択するか、リソースグループを選択してそのグループ内のリソースを選択します。
+
リソーストポロジページが表示されます。

. Manage Copies （コピーの管理）ビューから、プライマリまたはセカンダリ（ミラーまたはバックアップ）ストレージシステムから * Backups （バックアップ）を選択します。
. [Primary backup（s）]テーブルで、リストア元のバックアップを選択し、***をクリックしますimage:../media/restore_icon.gif["リストアアイコン"]。
+
image::../media/restoring_resource.gif[リソースのリストア]

. Restore Scope ページで、 *Complete Resource* を選択して、 SAP HANA データベースの設定済みデータボリュームをリストアします。
+

NOTE: Complete Resource * （ * Volume Revert * あり / なし）または * Tenant Database * のいずれかを選択できます。

+
ユーザが * テナントデータベース * オプションまたは * Complete Restore * オプションを選択した場合、複数のテナントに対して SnapCenter サーバがリカバリ処理をサポートしていません。リカバリ処理を実行するには、HANA StudioスクリプトまたはHANA Pythonスクリプトを使用する必要があります。

+
.. ボリューム全体をリストアする場合は、 * Volume Revert * を選択します。
+
このオプションは、NFS環境のSnapCenter 4.3で作成されたバックアップに使用できます。

+
リソースにボリュームまたはqtreeが含まれている場合、そのボリュームまたはqtreeでリストア対象として選択されたSnapshotのあとに作成されたSnapshotは削除され、リカバリすることはできません。また、同じボリュームまたはqtreeで他のリソースがホストされている場合、そのリソースも削除されます。このオプションは、リストア対象として「 * Volume Revert * 」オプションを指定した状態で * Complete Resource * を選択した場合に使用できます。

.. [* Tenant Database] を選択します。
+
このオプションは、MDCリソースに対してのみ使用できます。

+
リストア処理を実行する前に、テナントデータベースを停止してください。

+
「 * テナントデータベース * 」オプションを選択した場合は、リカバリ処理を実行するために、 HANA Studio を使用するか、 SnapCenter 外部の HANA リカバリスクリプトを使用する必要があります。



. [Recovery scope]ページで、次のいずれかのオプションを選択します。
+
|===
| 状況 | 操作 


 a| 
できるだけ現在の時刻に近い場所でリカバリしたい
 a| 
[* 最新の状態に回復する *] を選択します。単一コンテナリソースの場合は、ログおよびカタログバックアップの場所を1つ以上指定します。

マルチテナントデータベースコンテナ（MDC）リソースの場合は、ログバックアップの場所とバックアップカタログの場所を1つ以上指定します。

MDCリソースの場合、パスにシステムデータベースとテナントデータベースの両方のログが含まれている必要があります。



 a| 
指定した時点にリカバリする
 a| 
[* 特定の時点にリカバリする *] を選択します。

.. タイムゾーンを選択します。
+
ブラウザのタイムゾーンはデフォルトで設定されています。

+
選択したタイムゾーンと入力時間が絶対GMTに変換されます。

.. 日時を入力します。たとえば、HANA Linuxホストがカリフォルニア州サニーベールにあり、ローリーのユーザがSnapCenterにログインをリカバリしているとします。
+
これらのロケーション間の時間差は3時間で、ユーザはローリー（NC）からログインしているため、GUIで選択されるデフォルトのブラウザタイムゾーンはGMT-04:00です。

+
ユーザがカリフォルニア州サニーベール5時までのリカバリを実行する場合は、ブラウザのタイムゾーンをHANA Linuxホストのタイムゾーン（GMT-07：00）に設定し、日時を午前5時に指定する必要があります。

+
単一コンテナリソースの場合は、ログおよびカタログバックアップの場所を1つ以上指定します。

+
MDCリソースの場合は、ログバックアップの場所とバックアップカタログの場所を1つ以上指定します。

+
MDCリソースの場合、パスにシステムデータベースとテナントデータベースの両方のログが含まれている必要があります。





 a| 
特定のデータバックアップにリカバリする必要がある
 a| 
［ * 指定されたデータバックアップにリカバリする * ］ を選択します。



 a| 
リカバリが不要である場合
 a| 
「 * リカバリなし * 」を選択します。リカバリ処理は、HANA Studioから手動で実行する必要があります。

|===
+
SnapCenter 4.3へのアップグレード後に作成されたバックアップのみをリカバリできます。ただし、ホストとプラグインの両方がSnapCenter 4.3にアップグレードされ、自動検出されたリソースが変換または検出されたあとにリストア対象として選択されたバックアップが作成されている必要があります。

. [ リストア前 ] ページで、リストア・ジョブを実行する前に実行するプリ・リストアおよびアンマウント・コマンドを入力します。
+
自動検出されたリソースにはアンマウントコマンドを使用できません。

. [ ポスト・オペレーション ] ページで、マウントおよびリストア後のコマンドを入力して、リストア・ジョブの実行後に実行します。
+
自動検出されたリソースにはマウントコマンドを使用できません。

. [ 通知 ] ページの [ 電子メールの設定 *] ドロップダウンリストから、電子メールを送信するシナリオを選択します。
+
また、送信者と受信者のEメールアドレスとEメールの件名を指定する必要があります。また、 [* 設定 * （ Settings * ） ] > [* グローバル設定 * （ * Global Settings * ） ] ページでも SMTP を設定する必要があります。

. 概要を確認し、 [ 完了 ] をクリックします。
. 操作の進行状況を監視するには、 * Monitor * > * Jobs * をクリックします。

