---
permalink: protect-hana/task_create_backup_policies_for_sap_hana_databases.html 
sidebar: sidebar 
keywords: SnapCenter Plug-in for SAP HANA Database 
summary: SnapCenter を使用して SAP HANA データベースのリソースをバックアップする前に、バックアップ対象のリソースまたはリソースグループのバックアップポリシーを作成する必要があります。バックアップポリシーとは、バックアップを管理、スケジューリング、および保持する方法を定めた一連のルールです。 
---
= SAP HANA データベースのバックアップポリシーを作成する
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
SnapCenter を使用して SAP HANA データベースのリソースをバックアップする前に、バックアップ対象のリソースまたはリソースグループのバックアップポリシーを作成する必要があります。バックアップポリシーとは、バックアップを管理、スケジューリング、および保持する方法を定めた一連のルールです。

* 必要なもの *

* バックアップ戦略を定義しておく必要があります。
+
詳細については、 SAP HANA データベースのデータ保護戦略の定義に関する情報を参照してください。

* SnapCenter のインストール、ホストの追加、ストレージシステム接続のセットアップ、リソースの追加などのタスクを実行して、データ保護の準備をしておく必要があります。
* ユーザが Snapshot コピーをミラーまたはバックアップにレプリケートする場合は、ソースボリュームとデスティネーションボリューム両方の SnapCenter に SVM を割り当てる必要があります。
+
また、ポリシーでレプリケーション、スクリプト、およびアプリケーションの設定を指定することもできます。これらのオプションを指定しておくことで、別のリソースグループにポリシーを再利用して時間を節約することができます。



* このタスクについて *

* SAP HANA システムレプリケーション
+
** プライマリ SAP HANA システムとすべてのデータ保護処理を実行できます。
** セカンダリ SAP HANA システムは保護できますが、バックアップは作成できません。
+
フェイルオーバー後は、セカンダリ SAP HANA システムがプライマリ SAP HANA システムになるため、すべてのデータ保護処理を実行できます。

+
SAP HANA データボリュームのバックアップは作成できませんが、 SnapCenter は非データボリューム（ NDV ）の保護を継続します。





* 手順 *

. 左側のナビゲーションペインで、 * 設定 * をクリックします。
. [ 設定 ] ページで、 [ * ポリシー * ] をクリックします。
. [ 新規作成（ New ） ] をクリックする。
. [ 名前 ] ページで、ポリシー名と概要を入力します。
. 設定ページで、次の手順を実行します。
+
** バックアップタイプを選択します。
+
|===
| 状況 | 手順 


 a| 
データベースの整合性チェックを実行します
 a| 
ファイルベースのバックアップ * を選択します。アクティブなテナントのみがバックアップされます。



 a| 
Snapshot コピーテクノロジを使用してバックアップを作成します
 a| 
「 * Snapshot Based * 」を選択します。

|===
** スケジュールタイプを指定するには、「 * on demand * 」、「 * Hourly * 」、「 * Daily * 」、「 * Weekly * 」、または「 * Monthly * 」を選択します。
+

NOTE: リソースグループを作成する際に、バックアップ処理のスケジュール（開始日、終了日、頻度）を指定することができます。これにより、ポリシーとバックアップ間隔が同じである複数のリソースグループを作成できますが、各ポリシーに異なるバックアップスケジュールを割り当てることもできます。

+
image::../media/backup_settings.gif[バックアップ設定]

+

NOTE: 午前 2 時にスケジュールを設定した場合、夏時間（ DST ）中はスケジュールはトリガーされません。

** [ * カスタム・バックアップ設定 * ] セクションで、キー値形式でプラグインに渡す必要がある特定のバックアップ設定を指定します。
+
プラグインに渡すキーと値の組み合わせを複数指定することができます。



. [ 保持 ] ページで ' バックアップ・タイプの保持設定と [ バックアップ・タイプ ] ページで選択したスケジュール・タイプを指定します
+
|===
| 状況 | 作業 


 a| 
一定数の Snapshot コピーを保持します
 a| 
保持する Snapshot コピーの総数 * を選択し、保持する Snapshot コピーの数を指定します。

Snapshot コピーの数が指定した数を超えると、古いものから順に Snapshot コピーが削除されます。


NOTE: 最大保持数は、 ONTAP 9.4 以降のリソースでは 1018 、 ONTAP 9.3 以前のリソースでは 254 です。保持期間を基盤となる ONTAP バージョンの値よりも大きい値に設定すると、バックアップが失敗します。


IMPORTANT: Snapshot コピーベースのバックアップで SnapVault レプリケーションを有効にする場合は、保持数を 2 以上に設定する必要があります。保持数を 1 に設定すると、新しい Snapshot コピーがターゲットにレプリケートされるまで最初の Snapshot コピーが SnapVault 関係の参照 Snapshot コピーになるため、保持処理が失敗することがあります。


NOTE: SAP HANA システムのレプリケーションでは、 SAP HANA システムのすべてのリソースを 1 つのリソースグループに追加することを推奨します。これにより、適切な数のバックアップが保持されます。


NOTE: SAP HANA システムレプリケーションの場合、作成される Snapshot コピーの合計数は、リソースグループに対して設定された保持数と同じになります。最も古い Snapshot コピーの削除は、最も古い Snapshot コピーが配置されているノードに基づいて行われます。たとえば、 SAP HANA システムレプリケーションがプライマリ、 SAP HANA システムレプリケーションがセカンダリのリソースグループの場合、保持期間は 7 に設定されます。SAP HANA システムレプリケーションプライマリと SAP HANA システムレプリケーションセカンダリの両方を含め、一度に最大 7 個の Snapshot コピーを作成できます。



 a| 
Snapshot コピーを特定の日数だけ保持します
 a| 
「 * Snapshot コピーを保持する期間」を選択し、 Snapshot コピーを削除するまで保持する日数を指定します。

|===
. Snapshot コピーベースのバックアップの場合は、 Replication （レプリケーション）ページでレプリケーション設定を指定します。
+
|===
| フィールド | 手順 


 a| 
* ローカル Snapshot コピー作成後に SnapMirror を更新 *
 a| 
別のボリュームにバックアップセットのミラーコピーを作成する場合（ SnapMirror レプリケーション）は、このフィールドを選択します。

ONTAP の保護関係のタイプがミラーとバックアップの場合、このオプションのみを選択すると、プライマリで作成された Snapshot コピーがデスティネーションに転送されませんが、デスティネーションのリストに表示されます。この Snapshot コピーがリストア処理の対象としてデスティネーションで選択されると、「 Secondary Location is not available for the selected vaulted/mirrored backup 」というエラーメッセージが表示されます。



 a| 
* ローカル Snapshot コピー作成後に SnapVault を更新 *
 a| 
ディスクツーディスクのバックアップレプリケーション（ SnapVault バックアップ）を実行する場合は、このオプションを選択します。



 a| 
* 二次ポリシーラベル *
 a| 
Snapshot ラベルを選択します。

選択した Snapshot コピーラベルに応じて、 ONTAP はラベルに一致するセカンダリ Snapshot コピー保持ポリシーを適用します。


NOTE: ローカル Snapshot コピーの作成後に「 * SnapMirror を更新」を選択した場合は、必要に応じてセカンダリポリシーラベルを指定できます。ただし、ローカル Snapshot コピーの作成後に「 * Update SnapVault 」を選択した場合は、セカンダリポリシーラベルを指定する必要があります。



 a| 
* エラー再試行回数 *
 a| 
処理が停止されるまでに試行できるレプリケーションの最大回数を入力します。

|===
+

NOTE: セカンダリストレージでの Snapshot コピーの最大数に達しないように、 ONTAP でセカンダリストレージの SnapMirror 保持ポリシーを設定する必要があります。

. 概要を確認し、 [ 完了 ] をクリックします。

